---
title: "효도하고 싶은 아들이 만든 서비스"
categories:
  - Django
tags:
  - python
  - django
  - kakao openbuilder
---

# 어머니께 효도하기 위해 만든 서비스 : 효자봇

스스로 해본 개발이라고는 학교에서 하는 과제정도가 전부인 나에게 개발을 하고싶은 일이 생겼다.  
바로 어머니의 요구사항이었다. 이야기는 시간을 조금 거슬러 올라가 설날에 시작된다. 추석에 가족여행을 해외로 가보는 건 어떻냐는 의견에 다들 동의하고 비행기표를 검색하고 최저가로 예약하기 직전에 어머니가 한마디 하셨다.  
> "시간이 지나면서 더 싼 비행기가 나오면 어쩌니?"  
  "그러면 검색해서 더 싼게 나오면 알려드릴게요"

그리고 가족 단톡방에서 여행 계획 이야기가 나올 때 마다, 어머니는 혹시 더 싼 비행기표가 나왔는지 물어보셨다.
비행기표의 가격은 그리 많은 변동폭을 보이지 않았고, 추석연휴의 비행기 가격은 그리 큰 변동폭을 보이지 않을 것 만 같았다.  
처음 느꼈던 여행의 기쁨에 들떳던 마음도 잠시, 계속 비행기 가격을 보는게 귀찮아졌다. "이렇게 반년을 보내야 하는 것인가..."  
그렇게 효자봇의 구상이 시작되었다.
처음에는 요구사항을 정리했다.
> 1. 고정된 날짜의 비행기 최저가격을 보여줄 것
2. 하루에 한번 정도만 알려줘도 괜찮음
3. 정보를 받아보기 어렵지 않아야 함

가장 먼저 생각난 것을 챗봇이었다.  
그 중에서도 어머니께 가장 익숙한 카카오톡, 카톡으로 알려드릴 수 있으면 궁금하실 때 마다 보실 수 있을 것이라 생각했다.  
그 다음은 보여줄 데이터를 수집하는 것 이었다. 이는 파이썬과 셀레니움을 쓰면 된다는 리서치 결과에 따라 해결할 수 있어보였다.  
마지막으로는 모아둔 데이터를 전달 해 줄 API서버였다. 웹 프레임워크는 Django를 사용하기로 했다.

먼저 챗봇을 만들었다. [카카오톡 플러스친구](https://center-pf.kakao.com)에서 만들 수 있었으며, 운이 좋은 건지 나쁜건지 마침 [I카카오 오픈 빌더](https://i.kakao.com/openbuilder)로 챗봇기능이 옮겨간 직후였고 OBT를 신청한뒤 얼마지나지 않아 권한이 부여되었다는 메일을 받았다.

1단계인 챗봇 만들기 성공! 처음에는 인사를 받아보았다. 내가 안녕이라고 인사하면, 나에게 반갑게 인사해주는 챗봇!

그 다음으로는 데이터 수집. 파이썬과 셀레니움을 이용한 크롤러 제작은 공식 문서와 블로그 글들은 참고했다. 핵심적으로는 가상의 웹 드라이버를 하나 띄우고 사람이 작업하는 것 처럼 검색해 검색 결과페이지를 저장하는 것! 처음에 시도한 페이지는 [스카이스캐너](https://www.skyscanner.co.kr)였다. 역시 많은 사용자가 있는 만큼 크롤링이 허용되지 않았다. 그 차선책은 [트립닷컴](https://kr.trip.com) 이었다. 내가 보고싶은 날짜와 인원수 목적지는 이미 고정이므로, 요청 URL은 변하지 않을 것이다라는 가정으로 크롤러를 만들었다.
일단은 동작하게 만들고, 그 다음에 기능을 추가하거나, 코드를 수정하자는 원칙에 따라 돌아가게만들었다. 수집한 HTML코드는 beautifulSoup으로 파싱해 원하는 데이터들을 CSV형태로 저장했다.

저장된 데이터는 REST API 서버를 이용해 해당하는 요청에 응답으로 보내줄 것이다. 이렇게 완성된 크롤러. 잘 수집되었는지, 데이터는 이상이 없는지 눈으로 검증해주었다.

마지막으로 저장된 데이터를 보내줄 API 서버를 만드는 것. 다룰 줄 아는 웹 프레임워크가 Django 뿐어이서 일단 돌아가게 만들었다.
요청을 받으면 크롤러가 저장한 CSV파일을 읽어와 알맞는 응답을 보내주었다.
보내주는 데이터의 형식은 JSON으로 했다. 왜냐하면 카카오 챗봇에서 JSON의 형태의 데이터를 이용하기 때문이다.

마지막으로 다시 카카오 챗봇으로 돌아가서, 발화를 설정하고 그에 맞는 응답을 정해주면된다. 가격 이라고 입력했을 때 어떤 API를 불러 올 것인지 설정하고 그 응답 중 어떤 변수들을 메세지에 포함하여 표시할 것인지 정하면

가격을 알려주는 챗봇 프로토 타입 버젼 0.0.1이 완성된다.
