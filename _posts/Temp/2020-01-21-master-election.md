---
title: "마스터노드 선출 프로세스"
categories:
  - Temp
tags:
  - ElasticSearch
  - MasterElection
---
### 쿼럼 기반 의사 결정
#### Quorum-based decision making

마스터 노드의 선출과 클러스터의 상태변화는 마스터 적격 노드가 동작하기 위해 수행되어야 하는 두가지 기본 작업입니다.
일부 노드에서 실패가 일어났을 때, 이런 활동이 빈틈없이 일어나는 것은 중요합니다. ElasticSearch는 클러스터에서 마스터 적격 노드의 서브 셋인 쿼럼으로 부터 응답을 수신 했을 때 각 조치가 성공한 것으로 간주합니다. 이러한 과정을 통해 빈틈없이 실행합니다. 응답을 위해 노드의 서브셋만 필요로 하는데는 다음과 같은 이유가 있습니다. 일부 노드가 실패하더라도 클러스터의 진행을 방해하지 않는다는 장점이 있습니다. 쿼럼은 신중하기 선택되기 때문에 클러스터에 각 조각이 다른 조각과 일치하지 않는 결정을 내리는 "브레인 스필릿"과 같은 문제가 발생하지 않습니다.  

Elasticsearch를 사용하면 실행 가능한 클러스터에 마스터 적격 노드를 추가 및 제거 할 수 있습니다. 대부분의 경우 필요에 따라 노드를 시작하거나 중지하여 간단히 수행 할 수 있습니다. 노드 추가 및 제거를 참조하십시오.  

노드가 추가되거나 제거 될 때 Elasticsearch는 클러스터의 투표 구성을 업데이트하여 최적의 내결함성 수준을 유지합니다.이 구성은 새 마스터를 선출하거나 새 클러스터 상태를 커밋하는 등의 결정을 내릴 때 응답이 계산되는 마스터 적격 노드 집합입니다. 투표 구성에서 노드의 절반 이상이 응답 한 후에 만 ​​결정됩니다. 일반적으로 투표 구성은 현재 클러스터에있는 모든 마스터 적격 노드 세트와 동일합니다. 그러나 상황에 따라 상황이 다를 수 있습니다.

클러스터를 계속 사용할 수 있도록하려면 투표 구성에서 절반 이상의 노드를 동시에 중지해서는 안됩니다. 투표 노드의 절반 이상을 사용할 수있는 한 클러스터는 여전히 정상적으로 작동 할 수 있습니다. 이는 3 ~ 4 개의 마스터 적격 노드가있는 경우 클러스터가 그 중 하나를 사용할 수 없음을 허용 할 수 있음을 의미합니다. 마스터 적격 노드가 두 개 이하인 경우 모두 사용 가능한 상태로 유지해야합니다.

노드가 클러스터에 참여하거나 클러스터를 떠난 후 선출 된 마스터는 투표 구성을 조정하도록 클러스터 상태 업데이트를 발행해야하며 완료하는 데 약간의 시간이 걸릴 수 있습니다. 클러스터에서 더 많은 노드를 제거하기 전에이 조정이 완료 될 때까지 기다려야합니다.

#### Master elections
Elasticsearch는 선거 프로세스를 클러스터 시작 때와 기존의 선택된 마스터가 실패한 이 두 경우에 새로운 마스터 노드 선출을 위해 실행합니다. 모든 마스터 자격 노드는 선거를 시작할 수 있으며 일반적으로 첫 번째 제기한 노드가 당선에 성공합니다. 선거는 일반적으로 두 노드가 거의 동시에 선거를 시작할 때만 실패하므로 선거가 발생할 가능성을 줄이기 위해 각 노드에서 무작위로 선거가 예약됩니다. 노드는 마스터가 선출 될 때까지 선거를 재 시도하고, 실패시 퇴장하여 결국 선거에 성공할 수 있습니다 (임의적으로 높은 확률로). 마스터 선거 일정은 마스터 선거 설정에 의해 제어됩니다.


#### Cluster maintenance, rolling restarts and migrations
많은 클러스터 유지 관리 작업에는 하나 이상의 노드를 일시적으로 종료 한 다음 다시 시작해야합니다. 롤링 재시작과 같이 마스터 적격 노드 중 하나가 오프라인 상태가되면 Elasticsearch는 기본적으로 사용 가능한 상태를 유지할 수 있습니다. 또한 여러 노드가 중지되었다가 다시 시작되면 전체 클러스터 재시작과 같이 자동으로 복구됩니다. 마스터 노드 세트가 영구적으로 변경되지 않으므로 이러한 경우 여기에 설명 된 API로 추가 조치를 취할 필요가 없습니다.


출처 : https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery-quorums.html#modules-discovery-quorums
